---
title: Noip2016Day1T2 天天爱跑步
tags: LCA,差分
---


[题目链接](https://www.luogu.org/problem/P1600)

## problem

![](https://gitee.com/wxyww/picture/raw/master/小书匠/1570369361987.png)

## solution

**这是一道一个顶六个的好题!!!**

说一下各档部分分怎么写吧。

先看一下$S_i=1$和$T_i=1$的部分分怎么写。

**如果$S_i=1$**

当且仅当第$i$个点的深度$dep_i=w_i$时，该点可以观察到人。且观察到的人数为终点位于其子树内的人数。

**如果$T_i=1$**

这时第$i$个点能观察到的人数就是子树内起点深度=$dep_i+w[i]$的人数。用个桶记录下来这个值。

如果得到该子树内$dep[s_i]=dep_i+w[i]$的数量呢？

其实很简单。当第一次$bfs$到点$i$时，记录下桶中$dep_i+w[i]$的值，$dfs$整颗子树之后再得到一个值。将两个值作差即可。

**下面说满分做法**

将路径分为从$s$到$lca$和从$lca$到$t$两部分讨论。

先看从$s$到$lca$这部分。

那么对于一个点$i$就是要找<font color=red>$dep[lca]<=dep[i]$</font>且$dep_s=$